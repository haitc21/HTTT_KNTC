<div class="animated fadeIn grid card">
  <!-- --------------Sidebar--------------------------------------------------------- -->
  <div [@hideColumn]="hideColumnState" class="col-12 md:col-2 home-sidebar">
    <p-card>
      
      <ng-template pTemplate="header">
        <h5 class="home-sidebar-header">LỚP BẢN ĐỒ</h5>
      </ng-template>
      <!-- ----------------------------------------------------------------------- -->
      <div class="grid col-12 md:col-12">
        <div id="quyhoach" class="group-header ml-3">
          <img src="assets/images/map/quyhoach_icon.png" alt="Bản đồ quy hoạch" />
          <span>Bản đồ quy hoạch</span>    
            <p-inputSwitch [(ngModel)]="geo" (onChange)="loadData()"></p-inputSwitch>
        </div>
      </div>
      <!-- ----------------------------------------------------------------------- -->
      <div class="grid col-12 md:col-12">
        <div class="group-header ml-3">
          <img src="assets/images/map/marker-icon.png" alt="Khiếu nại" />
          <span>Khiếu nại</span>
        </div>
        <!-- ----------------------------------------------------------------------- -->
        <div class="inputgroup">
          <span class="ml-5">Đất đai</span>
          <p-inputSwitch [(ngModel)]="landComplaint" (onChange)="loadData()"></p-inputSwitch>
        </div>
        <!-- ----------------------------------------------------------------------- -->
        <div class="inputgroup">
          <span class="ml-5">Môi trường</span>
          <p-inputSwitch
            [(ngModel)]="enviromentalComplaint"
            (onChange)="loadData()"
          ></p-inputSwitch>
        </div>
        <!-- ----------------------------------------------------------------------- -->
        <div class="inputgroup">
          <span class="ml-5">Tài nguyên nước</span>
          <p-inputSwitch
            [(ngModel)]="waterResourceComplaint"
            (onChange)="loadData()"
          ></p-inputSwitch>
        </div>
        <!-- ----------------------------------------------------------------------- -->
        <div class="inputgroup">
          <span class="ml-5">Khoáng sản</span>
          <p-inputSwitch
            [(ngModel)]="mineralResourceComplaint"
            (onChange)="loadData()"
          ></p-inputSwitch>
        </div>
        <!-- ----------------------------------------------------------------------- -->
        <div class="group-header ml-3 mt-5">
          <img src="assets/images/map/marker-icon-red.png" class="icon-red" alt="Tố cáo" />
          <span>Tố Cáo</span>
        </div>
        <!-- ----------------------------------------------------------------------- -->
        <div class="inputgroup">
          <span class="ml-5">Đất đai</span>
          <p-inputSwitch [(ngModel)]="landAccusation" (onChange)="loadData()"></p-inputSwitch>
        </div>
        <!-- ----------------------------------------------------------------------- -->
        <div class="inputgroup">
          <span class="ml-5">Môi trường</span>
          <p-inputSwitch
            [(ngModel)]="emviromentalAccusation"
            (onChange)="loadData()"
          ></p-inputSwitch>
        </div>
        <!-- ----------------------------------------------------------------------- -->
        <div class="inputgroup">
          <span class="ml-5">Tài nguyên nước</span>
          <p-inputSwitch
            [(ngModel)]="waterResourceAccusation"
            (onChange)="loadData()"
          ></p-inputSwitch>
        </div>
        <!-- ----------------------------------------------------------------------- -->
        <div class="inputgroup">
          <span class="ml-5">Khoáng sản</span>
          <p-inputSwitch
            [(ngModel)]="mineralResourceAccusation"
            (onChange)="loadData()"
          ></p-inputSwitch>
        </div>
        <!-- ----------------------------------------------------------------------- -->
      </div>
    </p-card>
  </div>
  <!-- ----------------------Main------------------------------------------------- -->
  <div [@expandColumn]="expandColumnState" class="col-12 md:col-10 grid">
    <div
      style="height: 90vh; width: 1%"
      class="flex flex-column justify-content-center align-items-center"
    >
      <button
        *ngIf="visibleFilterLeff"
        pButton
        pRipple
        type="button"
        icon="pi pi-angle-left"
        class="p-button-info p-button-lg"
        (click)="toggleMenuLeft()"
      ></button>
      <button
        *ngIf="!visibleFilterLeff"
        pButton
        pRipple
        type="button"
        icon="pi pi-angle-right"
        class="p-button-info p-button-lg"
        (click)="toggleMenuLeft()"
      ></button>
    </div>
    <div style="width: 99%">
      <p-breadcrumb [model]="breadcrumb" [home]="home"></p-breadcrumb>
      <p-panel #pnl>
        <p-toolbar>
          <div class="formgrid grid col-12">
            <div class="field col-12 md:col-3">
              <span class="p-input-icon-left w-full">
                <i class="pi pi-search"></i>
                <input
                  pInputText
                  type="text"
                  (keyup.enter)="loadData()"
                  [(ngModel)]="keyword"
                  placeholder="Tìm kiếm"
                  class="w-full"
                />
              </span>
            </div>
            <!-- --------------------------------------------------------------------------------- -->
            <div class="field col-12 md:col-3">
              <span class="p-float-label">
                <p-dropdown
                  [options]="loaiVuviecOptions"
                  [(ngModel)]="loaiVuviec"
                  optionLabel="text"
                  optionValue="value"
                  [showClear]="true"
                  [autoDisplayFirst]="false"
                  styleClass="w-full"
                  (onChange)="loadData($event)"
                ></p-dropdown>
                <label>Phân loại</label>
              </span>
            </div>
            <!-- --------------------------------------------------------------------------------- -->
            <div class="field col-12 md:col-3">
              <span class="p-float-label">
                <p-dropdown
                  [options]="tinhOptions"
                  [(ngModel)]="maTinh"
                  optionLabel="unitName"
                  optionValue="id"
                  [showClear]="true"
                  [autoDisplayFirst]="false"
                  [filter]="true"
                  filterBy="unitName"
                  styleClass="w-full"
                  (onChange)="TinhChange($event)"
                ></p-dropdown>
                <label>Tỉnh/TP</label>
              </span>
            </div>
            <!-- --------------------------------------------------------------------------------- -->
            <div class="field col-12 md:col-3">
              <span class="p-float-label">
                <p-dropdown
                  [options]="huyenOptions"
                  [(ngModel)]="maHuyen"
                  optionLabel="unitName"
                  optionValue="id"
                  [showClear]="true"
                  [autoDisplayFirst]="false"
                  [filter]="true"
                  filterBy="unitName"
                  styleClass="w-full"
                  (onChange)="huyenChange($event)"
                ></p-dropdown>
                <label>Quận/Huyện</label>
              </span>
            </div>
            <!-- --------------------------------------------------------------------------------- -->
            <div class="field col-12 md:col-3">
              <span class="p-float-label">
                <p-dropdown
                  [options]="xaOptions"
                  [(ngModel)]="maXa"
                  optionLabel="unitName"
                  optionValue="id"
                  [showClear]="true"
                  [autoDisplayFirst]="false"
                  [filter]="true"
                  filterBy="unitName"
                  styleClass="w-full"
                  (onChange)="loadData()"
                ></p-dropdown>
                <label for="phoneNumber">Phường/Xã</label>
              </span>
            </div>
            <!-- --------------------------------------------------------------------------------- -->
            <div class="field col-12 md:col-3">
              <span class="p-float-label">
                <p-calendar
                  appendTo="body"
                  [(ngModel)]="thoiGianTiepNhanRange"
                  selectionMode="range"
                  dateFormat="dd/mm/yy"
                  [showClear]="true"
                  inputId="thoiGianTiepNhanRange"
                  (onSelect)="thoiGiantiepNhanChange()"
                  (onClear)="thoiGiantiepNhanChange()"
                ></p-calendar>
                <label for="phoneNumber">Thời gian tiếp nhận</label>
              </span>
            </div>
            <!-- --------------------------------------------------------------------------------- -->
            <div class="field col-12 md:col-3">
              <span class="p-float-label">
                <p-dropdown
                  [options]="giaiDoanOptions"
                  [(ngModel)]="giaiDoan"
                  optionLabel="text"
                  optionValue="value"
                  [showClear]="true"
                  [autoDisplayFirst]="false"
                  styleClass="w-full"
                  (onChange)="loadData()"
                ></p-dropdown>
                <label for="phoneNumber">Giai đoạn</label>
              </span>
            </div>
            <!-- --------------------------------------------------------------------------------- -->
            <div class="field col-12 md:col-3">
              <span class="p-float-label">
                <p-dropdown
                  [options]="loaiKQOptions"
                  [(ngModel)]="tinhTrang"
                  optionLabel="text"
                  optionValue="value"
                  [showClear]="true"
                  [autoDisplayFirst]="false"
                  styleClass="w-full"
                  (onChange)="loadData()"
                ></p-dropdown>
                <label for="phoneNumber">Tình trạng</label>
              </span>
            </div>
          </div>
        </p-toolbar>
        <p-card>
          <app-map idMap="searchMap" [data]="data" [spatialData]="spatialData"></app-map>
        </p-card>
        <!-- ----------------------------------------------------------------------- -->
        <p-card>
          <p-toolbar>
            <ng-template pTemplate="left"> 
              <i class="pi pi-search mr-2"></i>
              <h5>Kết quả tìm kiếm</h5>
            </ng-template>

            <ng-template pTemplate="right">
              <button
                type="button"
                pButton
                pRipple
                label="Xuất"
                icon="pi pi-download"
                class="p-button-info mr-2"
              ></button>
              <button
                type="button"
                pButton
                pRipple
                label="In"
                icon="pi pi-print"
                class="p-button-info"
              ></button>
            </ng-template>
          </p-toolbar>

          <!-- <p-table
          #dt
          [value]="data"
          [rows]="10"
          [paginator]="false"
          [(selection)]="selectedItems"
          [rowHover]="true"
          dataKey="id"
        > -->
          <p-table
            #dt
            [value]="data"
            [rows]="10"
            [paginator]="true"
            [globalFilterFields]="['code', 'title']"
            [tableStyle]="{ 'width': '100%' }"
            [(selection)]="selectedItems"
            [rowHover]="true"
            dataKey="code"
            currentPageReportTemplate="Tổng số: {totalRecords}"
            [showCurrentPageReport]="true"
          >
            <ng-template pTemplate="header" let-columns>
              <tr>
                <th class="row-num-column">STT</th>
                <th>Mã hồ sơ</th>
                <th>Nội dung đơn</th>
                <th>Người gửi đơn</th>
                <th>Khu vực</th>
                <th>Ngày nộp đơn</th>
                <th>Loại khiếu nai/tố cáo</th>
                <th>Lĩnh vực</th>
                <th>Ngày hẹn trả KQ lần I</th>
                <th>KQ GQKN lần I</th>
                <th>Ngày hẹn trả KQ lần II</th>
                <th>KQ GQKN lần II</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-row let-rowIndex="rowIndex" let-columns="columns">
              <tr>
                <td class="row-num-cell">{{ rowIndex + 1 }}</td>
                <td>{{ row.maHoSo }}</td>
                <td>{{ row.tieuDe }}</td>
                <td>{{ row.nguoiDeNghi }}</td>
                <td>{{ row.maQuanHuyen }} - {{row.maXaPhuongTT}}</td>
                <td>{{ row.thoiGianTiepNhan.toLocaleDateString('vi-VN') }}</td>
                <td>{{ LoaiVuViec[row.typeHoSo] }}</td>
                <td>{{ LinhVuc[row.fieldType] }}</td>
                <td>{{ row.ngayTraKQ1.toLocaleDateString('vi-VN') }}</td>
                <td>{{ row.ketQua1 ? 'Đúng' : 'Sai' }}</td>
                <td>{{ row.ngayTraKQ2 ? row.ngayTraKQ2.toLocaleDateString('vi-VN') : '' }}</td>
                <td>{{ row.ketQua2 === true ? 'Đúng' : row.result2 === false ? 'Sai' : '' }}</td>
              </tr>
            </ng-template>
            <!-- <ng-template pTemplate="summary">
            <p-paginator
              [rows]="maxResultCount"
              [totalRecords]="totalCount"
              [showCurrentPageReport]="true"
              [showJumpToPageInput]="true"
              (onPageChange)="pageChanged($event)"
              currentPageReportTemplate="{totalRecords} bản ghi, {currentPage} trang"
              [rowsPerPageOptions]="[10, 20, 50, 100]"
            ></p-paginator>
          </ng-template> -->
          </p-table>
          <!-- ----------------------------------------------------------------------- -->
        </p-card>
        <!-- ----------------------------------------------------------------------- -->
        <p-blockUI [target]="pnl" [blocked]="blockedPanel">
          <p-progressSpinner
            [style]="{
              width: '100px',
              height: '100px',
              position: 'absolute',
              top: '25%',
              left: '50%'
            }"
            strokeWidth="2"
            animationDuration=".5s"
          ></p-progressSpinner>
        </p-blockUI>
      </p-panel>
    </div>
  </div>
</div>
